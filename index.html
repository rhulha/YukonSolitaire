<!DOCTYPE HTML>
<html>
<head>
	<style>
	body {
		background-color: green;
	}
	.spot {
		margin-left: 60px;
		margin-top: 80px;
		height: 220px;
		width: 140px;
		float: left;
		position:relative;
		border: 1px red solid;
		z-index: -1;
	}
	.card {
		position: absolute;
		top: 66px;
		left: -1px;
		width: 140px;
		height: 220px;
		background-color: white;
		border-radius: 15px;
		border: 1px solid black;
		user-select: none;
		cursor: default;
	}
	.red {
		color: red;
	}
	.black {
		color: black;
	}
	.topLeft {
		position: absolute;
		font-size: 60px;
		left: 12px;
	}
	.topRight {
		position: absolute;
		font-size: 60px;
		right: 12px;
	}
	.suit {
		font-size: 150px;
	}
	.backside {
		top: 20px;
		background-color: lightblue;
	}
	.hidden {
		display: none;
	}
	span {
		pointer-events: none
	}
	</style>
</head>
<body>

<div class="spot"></div>
<div class="spot"></div>
<div class="spot"></div>
<div class="spot"></div>
<div class="spot"></div>
<div class="spot"></div>
<div class="spot"></div>

<div class="card backside">
	<span class="topLeft hidden"></span>
    <span class="topRight hidden"></span>
	<br/>
	<span class="suit hidden"></span>
</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>

<script>
	// http://labs.mintchaos.com/flippant.js/
	
	function shuffle(a) {
		for (var i = a.length - 1; i > 0; i--) {
			var j = Math.floor(Math.random() * (i + 1));
			var temp = a[i];a[i] = a[j];a[j] = temp;
		}
		return a;
	}
	$(function() {
		var suitList = ['&clubs;', '&spades;', '&hearts;', '&diams;'];
		var colorList = ['black', 'black', 'red', 'red'];
		var pics = ['J', 'Q', 'K'];
		
		function cloneDeckFromBaseCard( baseCard ) {
			var cards = [];
			for( var suit=0; suit<4; suit++) {
				for( var value=1; value<14; value++) {
					var card = baseCard.clone();
					card.attr({
						id: 'id_'+suit+'_'+value,
						suit: suit,
						value: value
					});
					var spans = card.children('span');
					spans.eq(0).html(value == 1 ? 'A' : (value>10?pics[value-11]:value));
					spans.eq(1).html(suitList[suit]);
					spans.eq(2).html(suitList[suit]);
					cards.push( card);
				}
			}
			return cards;
		}
		
		function reveal(card) {
			var c = colorList[card.attr('suit')];
			card.removeClass('backside');
			card.children('span').removeClass('hidden').addClass(c);
			//setupDraggable( card);
			//$(card).draggable({disabled: false});
		}

		function setupBoard(cards) {
			reveal(cards[0]);
			var spots = $('.spot');
			
			spots.eq(0).append(cards[0]);

			var counter=1;
			for( var col=1; col<7; col++) {
				for( var row=0; row<5+col; row++) {
					var card = cards[counter++];
					if( row > col -1 )
						reveal( card);
					var spot = spots.eq(col);
					if( spot.children().length == 0)
						spot.append(card);
					else
						spot.find('.card').last().append( card )
					if( row == 4+col ) {
						//card.droppable({disabled: false});
					} else {
						//card.droppable({disabled: true});
					}
				}
			}
		}
		
		var md = false;
		var mdTarget, mdTargetPos, mdPageX, mdPageY;

		$(document).mousedown( function(e) {
			mdTarget = $(e.target);
			
			if( !mdTarget.hasClass('card')) {
				mdTarget = mdTarget.parent();
			}
			
			if( mdTarget.hasClass('card') && !mdTarget.hasClass('backside')) {
				mdTargetPos = mdTarget.position();
				mdPageX = e.pageX;
				mdPageY = e.pageY;
				md = true;
				mdTarget.css('pointer-events', 'none');
			}
			e.preventDefault();
		});

		$(document).mouseup( function(e){
			if( md) {
				md = false;
				mdTarget.css({
					top: mdTargetPos.top,
					left: mdTargetPos.left,
					pointerEvents: 'auto'
				});
			}
		});

		$(document).mousemove( function(e) {
			if( md) {
				pageX = e.pageX;
				pageY = e.pageY;
				//var el = document.elementFromPoint(pageX,pageY);
				var el = e.target;
				$(el).css({borderColor: 'red'});
				mdTarget.css({
					top: mdTargetPos.top + pageY - mdPageY,
					left: mdTargetPos.left + pageX - mdPageX
				});
			}
		});

		var baseCard = $('.card').first();
		var cards = cloneDeckFromBaseCard( baseCard);
		$(baseCard).hide();
		shuffle( cards);
		setupBoard(cards);
		
	});
</script>
  
</body>
</html>
